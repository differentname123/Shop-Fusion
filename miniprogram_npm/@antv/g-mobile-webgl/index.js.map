{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nvar tslib = require('tslib');\nvar gLite = require('@antv/g-lite');\nvar DeviceRenderer = require('@antv/g-plugin-device-renderer');\nvar DragDropEvent = require('@antv/g-plugin-dragndrop');\nvar HTMLRenderer = require('@antv/g-plugin-html-renderer');\nvar ImageLoader = require('@antv/g-plugin-image-loader');\nvar DomInteraction = require('@antv/g-plugin-mobile-interaction');\nvar GesturePlugin = require('@antv/g-plugin-gesture');\nvar util = require('@antv/util');\nvar gDeviceApi = require('@antv/g-device-api');\n\nfunction _interopNamespaceDefault(e) {\n    var n = Object.create(null);\n    if (e) {\n        Object.keys(e).forEach(function (k) {\n            if (k !== 'default') {\n                var d = Object.getOwnPropertyDescriptor(e, k);\n                Object.defineProperty(n, k, d.get ? d : {\n                    enumerable: true,\n                    get: function () { return e[k]; }\n                });\n            }\n        });\n    }\n    n.default = e;\n    return Object.freeze(n);\n}\n\nvar DeviceRenderer__namespace = /*#__PURE__*/_interopNamespaceDefault(DeviceRenderer);\nvar DragDropEvent__namespace = /*#__PURE__*/_interopNamespaceDefault(DragDropEvent);\nvar HTMLRenderer__namespace = /*#__PURE__*/_interopNamespaceDefault(HTMLRenderer);\nvar ImageLoader__namespace = /*#__PURE__*/_interopNamespaceDefault(ImageLoader);\nvar DomInteraction__namespace = /*#__PURE__*/_interopNamespaceDefault(DomInteraction);\nvar GesturePlugin__namespace = /*#__PURE__*/_interopNamespaceDefault(GesturePlugin);\n\nfunction isCanvasElement(el) {\n    if (!el || typeof el !== 'object')\n        return false;\n    if (el.nodeType === 1 && el.nodeName) {\n        // HTMLCanvasElement\n        return true;\n    }\n    // CanvasElement\n    return !!el.isCanvasElement;\n}\n\nvar WebGLContextService = /** @class */ (function () {\n    function WebGLContextService(context) {\n        this.canvasConfig = context.config;\n        // @ts-ignore\n        this.deviceRendererPlugin = context.deviceRendererPlugin;\n    }\n    WebGLContextService.prototype.init = function () {\n        return tslib.__awaiter(this, void 0, void 0, function () {\n            var _a, canvas, devicePixelRatio, dpr;\n            return tslib.__generator(this, function (_b) {\n                _a = this.canvasConfig, canvas = _a.canvas, devicePixelRatio = _a.devicePixelRatio;\n                this.$canvas = canvas;\n                // 实际获取到小程序环境的上下文\n                this.context = this.$canvas.getContext('webgl');\n                dpr = devicePixelRatio || 1;\n                dpr = dpr >= 1 ? Math.ceil(dpr) : 1;\n                this.dpr = dpr;\n                this.resize(this.canvasConfig.width, this.canvasConfig.height);\n                return [2 /*return*/];\n            });\n        });\n    };\n    WebGLContextService.prototype.getContext = function () {\n        return this.context;\n    };\n    WebGLContextService.prototype.getDomElement = function () {\n        return this.$canvas;\n    };\n    WebGLContextService.prototype.getDPR = function () {\n        return this.dpr;\n    };\n    WebGLContextService.prototype.getBoundingClientRect = function () {\n        if (this.$canvas.getBoundingClientRect) {\n            return this.$canvas.getBoundingClientRect();\n        }\n    };\n    WebGLContextService.prototype.destroy = function () {\n        // TODO: 小程序环境销毁 context\n        this.context = null;\n        this.$canvas = null;\n    };\n    WebGLContextService.prototype.resize = function (width, height) {\n        var pixelRatio = devicePixelRatio;\n        var canvasDOM = this.$canvas; // HTMLCanvasElement or canvasElement\n        // 浏览器环境设置style样式\n        // @ts-ignore 使用style功能判断不使用类型判断更准确\n        if (canvasDOM.style) {\n            // @ts-ignore\n            canvasDOM.style.width = width + 'px';\n            // @ts-ignore\n            canvasDOM.style.height = height + 'px';\n        }\n        if (isCanvasElement(canvasDOM)) {\n            canvasDOM.width = width * pixelRatio;\n            canvasDOM.height = height * pixelRatio;\n            // if (pixelRatio !== 1) {\n            //   this.context.scale(pixelRatio, pixelRatio);\n            // }\n        }\n    };\n    WebGLContextService.prototype.applyCursorStyle = function (cursor) {\n        // 小程序环境无需设置鼠标样式\n    };\n    WebGLContextService.prototype.toDataURL = function (options) {\n        return tslib.__awaiter(this, void 0, void 0, function () {\n            return tslib.__generator(this, function (_a) {\n                return [2 /*return*/, this.deviceRendererPlugin.toDataURL(options)];\n            });\n        });\n    };\n    return WebGLContextService;\n}());\n\nvar ContextRegisterPlugin = /** @class */ (function (_super) {\n    tslib.__extends(ContextRegisterPlugin, _super);\n    function ContextRegisterPlugin(rendererPlugin, config) {\n        var _this = _super.call(this) || this;\n        _this.rendererPlugin = rendererPlugin;\n        _this.config = config;\n        _this.name = 'mobile-webgl-context-register';\n        return _this;\n    }\n    ContextRegisterPlugin.prototype.init = function () {\n        this.context.ContextService = WebGLContextService;\n        this.context.deviceRendererPlugin = this.rendererPlugin;\n        var config = this.config;\n        this.context.deviceContribution = new gDeviceApi.WebGLDeviceContribution(tslib.__assign({}, ((config === null || config === void 0 ? void 0 : config.targets)\n            ? {\n                targets: config.targets,\n            }\n            : {\n                targets: ['webgl2', 'webgl1'],\n            })));\n    };\n    ContextRegisterPlugin.prototype.destroy = function () {\n        delete this.context.ContextService;\n    };\n    return ContextRegisterPlugin;\n}(gLite.AbstractRendererPlugin));\n\nvar Renderer = /** @class */ (function (_super) {\n    tslib.__extends(Renderer, _super);\n    function Renderer(config) {\n        var _this = _super.call(this, config) || this;\n        var deviceRendererPlugin = new DeviceRenderer__namespace.Plugin();\n        _this.registerPlugin(new ContextRegisterPlugin(deviceRendererPlugin, config));\n        _this.registerPlugin(new ImageLoader__namespace.Plugin());\n        _this.registerPlugin(deviceRendererPlugin);\n        _this.registerPlugin(new DomInteraction__namespace.Plugin());\n        _this.registerPlugin(new HTMLRenderer__namespace.Plugin());\n        _this.registerPlugin(new DragDropEvent__namespace.Plugin({\n            isDocumentDraggable: util.isNil(config === null || config === void 0 ? void 0 : config.isDocumentDraggable)\n                ? true\n                : config.isDocumentDraggable,\n            isDocumentDroppable: util.isNil(config === null || config === void 0 ? void 0 : config.isDocumentDroppable)\n                ? true\n                : config.isDocumentDroppable,\n            dragstartDistanceThreshold: util.isNil(config === null || config === void 0 ? void 0 : config.dragstartDistanceThreshold)\n                ? 10\n                : config.dragstartDistanceThreshold,\n            dragstartTimeThreshold: util.isNil(config === null || config === void 0 ? void 0 : config.dragstartTimeThreshold)\n                ? 50\n                : config.dragstartTimeThreshold,\n        }));\n        _this.registerPlugin(new GesturePlugin__namespace.Plugin({\n            isDocumentGestureEnabled: true,\n        }));\n        return _this;\n    }\n    return Renderer;\n}(gLite.AbstractRenderer));\n\nexports.DeviceRenderer = DeviceRenderer__namespace;\nexports.HTMLRenderer = HTMLRenderer__namespace;\nexports.DomInteraction = DomInteraction__namespace;\nexports.Renderer = Renderer;\n//# sourceMappingURL=index.js.map\n"]}